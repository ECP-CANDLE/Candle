<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>candle.parsing_utils &mdash; ECP-CANDLE</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> CANDLE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">What is CANDLE?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../candle/candle.html"><code class="docutils literal notranslate"><span class="pre">candle</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shared_installation.html">CANDLE Shared Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">How to Contribute</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CANDLE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">candle.parsing_utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for candle.parsing_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>  <span class="c1"># pylint: disable=no-name-in-module</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">.file_utils</span> <span class="kn">import</span> <span class="n">directory_from_parameters</span>
<span class="kn">from</span> <span class="nn">.helper_utils</span> <span class="kn">import</span> <span class="n">str2bool</span>

<span class="c1"># Seed for random generation -- default value</span>
<span class="n">DEFAULT_SEED</span> <span class="o">=</span> <span class="mi">7102</span>
<span class="n">DEFAULT_TIMEOUT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># no timeout</span>
<span class="n">DEFAULT_DATATYPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>


<div class="viewcode-block" id="ArgumentStruct"><a class="viewcode-back" href="../../candle/candle.html#candle.ArgumentStruct">[docs]</a><span class="k">class</span> <span class="nc">ArgumentStruct</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that converts a python dictionary into an object with named</span>
<span class="sd">    entries given by the dictionary keys.</span>

<span class="sd">    This structure simplifies the calling convention for accessing the</span>
<span class="sd">    dictionary values (corresponding to problem parameters). After the</span>
<span class="sd">    object instantiation both modes of access (dictionary or object</span>
<span class="sd">    entries) can be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">entries</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">ListOfListsAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class extends the argparse.Action class by instantiating an</span>
<span class="sd">    argparser that constructs a list-of-lists from an input (command-line</span>
<span class="sd">    option or argument) given as a string.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_strings</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a ListOfListsAction object. If no type is specified, an</span>
<span class="sd">        integer is assumed by default as the type for the elements of the list-</span>
<span class="sd">        of-lists.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        option_strings : string</span>
<span class="sd">            String to parse</span>
<span class="sd">        dest : object</span>
<span class="sd">            Object to store the output (in this case the parsed list-of-lists).</span>
<span class="sd">        type : data type</span>
<span class="sd">            Data type to decode the elements of the lists.</span>
<span class="sd">            Defaults to np.int32.</span>
<span class="sd">        kwargs : object</span>
<span class="sd">            Python object containing other argparse.Action parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ListOfListsAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">option_strings</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function overrides the __call__ method of the base</span>
<span class="sd">        argparse.Action class.</span>

<span class="sd">        This function implements the action of the ListOfListAction</span>
<span class="sd">        class by parsing an input string (command-line option or argument)</span>
<span class="sd">        and maping it into a list-of-lists. The resulting list-of-lists is</span>
<span class="sd">        added to the namespace of parsed arguments. The parsing assumes that</span>
<span class="sd">        the separator between lists is a colon &#39;:&#39; and the separator inside</span>
<span class="sd">        the list is a comma &#39;,&#39;. The values of the list are casted to the</span>
<span class="sd">        type specified at the object initialization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parser : ArgumentParser object</span>
<span class="sd">            Object that contains this action</span>
<span class="sd">        namespace : Namespace object</span>
<span class="sd">            Namespace object that will be returned by the parse_args()</span>
<span class="sd">            function.</span>
<span class="sd">        values : string</span>
<span class="sd">            The associated command-line arguments converted to string type</span>
<span class="sd">            (i.e. input).</span>
<span class="sd">        option_string : string</span>
<span class="sd">            The option string that was used to invoke this action. (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">decoded_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">removed1</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">removed2</span> <span class="o">=</span> <span class="n">removed1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">out_list</span> <span class="o">=</span> <span class="n">removed2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out_list</span><span class="p">:</span>
            <span class="n">in_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">elem</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                <span class="n">in_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
            <span class="n">decoded_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">in_list</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">decoded_list</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ParseDict</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Definition of the dictionary structure expected for the parsing of</span>
<span class="sd">    parameters.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">abv</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">ListOfListsAction</span><span class="p">]]</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">default</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">help</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">choices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">nargs</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">ConfigDict</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Definition of the dictionary structure expected for the configuration of</span>
<span class="sd">    parameters.&quot;&quot;&quot;</span>

    <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">rng_seed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">train_bool</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">eval_bool</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">gpus</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>
    <span class="n">profiling</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">home_dir</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">train_data</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">val_data</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">test_data</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">experiment_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">logfile</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scaling</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">feature_subsample</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dense</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>
    <span class="n">conv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>
    <span class="n">locally_connected</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">activation</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">out_activation</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">lstm_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">recurrent_dropout</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">pool</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">batch_normalization</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">loss</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">optimizer</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">early_stop</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">momentum</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">initialization</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">val_split</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">train_steps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">val_steps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">test_steps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">train_samples</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">val_samples</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">clr_flag</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">clr_mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">clr_base_lr</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">clr_max_lr</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">clr_gamma</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">ckpt_restart_mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ckpt_checksum</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">ckpt_skip_epochs</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ckpt_directory</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ckpt_save_best</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">ckpt_save_best_metric</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ckpt_save_weights_only</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">ckpt_save_interval</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ckpt_keep_mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ckpt_keep_limit</span><span class="p">:</span> <span class="nb">int</span>


<span class="n">basic_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;config_file&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;specify model configuration file&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;data_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;f16&quot;</span><span class="p">,</span> <span class="s2">&quot;f32&quot;</span><span class="p">,</span> <span class="s2">&quot;f64&quot;</span><span class="p">],</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;default floating point.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rng_seed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;random number generator seed.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;train_bool&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;train model.&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;eval_bool&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;evaluate model (use it for inference).&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;timeout&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;seconds allowed to train model (default: no timeout).&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;gpus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nargs&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;set IDs of GPUs to use.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;profiling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Turn profiling on or off.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">input_output_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;save_path&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;file path to save model snapshots.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;model_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;specify model name to use when building filenames for saving.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;home_dir&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;set home directory.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;train_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;training data filename.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;val_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;validation data filename.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;testing data filename.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;output_dir&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;output directory.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;data_url&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;set data source url.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;experiment_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;EXP000&quot;</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;set the experiment unique identifier.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;run_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;RUN000&quot;</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;set the run unique identifier.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">logging_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;increase output verbosity.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;logfile&quot;</span><span class="p">,</span> <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;log file&quot;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">data_preprocess_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;scaling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;minabs&quot;</span><span class="p">,</span> <span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">],</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;type of feature scaling; &#39;minabs&#39;: to [-1,1]; &#39;minmax&#39;: to [0,1], &#39;std&#39;: standard unit normalization; &#39;none&#39;: no normalization.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;shuffle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;randomly shuffle data set (produces different training and testing partitions each run depending on the seed)&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;feature_subsample&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;number of features to randomly sample from each category (cellline expression, drug descriptors, etc), 0 means using all features&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">model_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dense&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nargs&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;number of units in fully connected layers in an integer array.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;conv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nargs&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;integer array describing convolution layers: conv1_filters, conv1_filter_len, conv1_stride, conv2_filters, conv2_filter_len, conv2_stride ....&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;locally_connected&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;use locally connected layers instead of convolution layers.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;activation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;keras activation function to use in inner layers: relu, tanh, sigmoid...&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;out_activation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;keras activation function to use in out layer: softmax, linear, ...&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstm_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nargs&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;integer array describing size of LSTM internal state per layer.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;recurrent_dropout&quot;</span><span class="p">,</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;ratio of recurrent dropout.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dropout&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;ratio of dropout used in fully connected layers.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;pool&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;pooling layer length.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_normalization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;use batch normalization.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;loss&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;keras loss function to use: mse, ...&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;optimizer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;keras optimizer to use: sgd, rmsprop, ...&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;metrics&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;metrics to evaluate performance: accuracy, ...&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">training_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;epochs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;number of training epochs.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;batch size.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;learning_rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abv&quot;</span><span class="p">:</span> <span class="s2">&quot;lr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;overrides the learning rate for training.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;early_stop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;activates keras callback for early stopping of training in function of the monitored variable specified.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;momentum&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;overrides the momentum to use in the SGD optimizer when training.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;initialization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
            <span class="s2">&quot;normal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;glorot_uniform&quot;</span><span class="p">,</span>
            <span class="s2">&quot;glorot_normal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lecun_uniform&quot;</span><span class="p">,</span>
            <span class="s2">&quot;he_normal&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;type of weight initialization; &#39;constant&#39;: to 0; &#39;uniform&#39;: to [-0.05,0.05], &#39;normal&#39;: mean 0, stddev 0.05; &#39;glorot_uniform&#39;: [-lim,lim] with lim = sqrt(6/(fan_in+fan_out)); &#39;lecun_uniform&#39; : [-lim,lim] with lim = sqrt(3/fan_in); &#39;he_normal&#39; : mean 0, stddev sqrt(2/fan_in).&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;val_split&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;fraction of data to use in validation.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;train_steps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;overrides the number of training batches per epoch if set to nonzero.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;val_steps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;overrides the number of validation batches per epoch if set to nonzero.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_steps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;overrides the number of test batches per epoch if set to nonzero.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;train_samples&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;overrides the number of training samples if set to nonzero.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;val_samples&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;overrides the number of validation samples if set to nonzero.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">cyclic_learning_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;clr_flag&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;CLR flag (boolean).&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;clr_mode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;trng1&quot;</span><span class="p">,</span> <span class="s2">&quot;trng2&quot;</span><span class="p">,</span> <span class="s2">&quot;exp&quot;</span><span class="p">],</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;CLR mode (default: trng1).&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;clr_base_lr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Base lr for cycle lr.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;clr_max_lr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Max lr for cycle lr.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;clr_gamma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Gamma parameter for learning cycle LR.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">ckpt_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_restart_mode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;off&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">],</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Mode to restart from a saved checkpoint file, choices are &#39;off&#39;, &#39;auto&#39;, &#39;required&#39;.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_checksum&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Checksum the restart file after read+write.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_skip_epochs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of epochs to skip before saving epochs.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_directory&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;./save&quot;</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Base directory in which to save checkpoints.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_save_best&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Toggle saving best model.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_save_best_metric&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;val_loss&quot;</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Metric for determining when to save best model.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_save_weights_only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">str2bool</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Toggle saving only weights (not optimizer) (NYI).&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_save_interval&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Interval to save checkpoints.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_keep_mode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;exponential&quot;</span><span class="p">],</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Checkpoint saving mode, choices are &#39;linear&#39; or &#39;exponential&#39;.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ckpt_keep_limit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">,</span>
        <span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Limit checkpoints to keep.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">registered_conf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">basic_conf</span><span class="p">,</span>
    <span class="n">input_output_conf</span><span class="p">,</span>
    <span class="n">logging_conf</span><span class="p">,</span>
    <span class="n">data_preprocess_conf</span><span class="p">,</span>
    <span class="n">model_conf</span><span class="p">,</span>
    <span class="n">training_conf</span><span class="p">,</span>
    <span class="n">cyclic_learning_conf</span><span class="p">,</span>
    <span class="n">ckpt_conf</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">extract_keywords</span><span class="p">(</span><span class="n">lst_dict</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the value associated to a specific keyword in a list of</span>
<span class="sd">    dictionaries. Returns the list of values extracted from the keywords.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lst_dict : python list of dictionaries</span>
<span class="sd">       list to extract keywords from</span>
<span class="sd">    kw : string</span>
<span class="sd">       keyword to extract from dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">di</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">lst_dict</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lst</span>


<span class="c1"># Extract list of parameters in registered configuration</span>
<span class="n">PARAMETERS_CANDLE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">item</span> <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">registered_conf</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">extract_keywords</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">CONFLICT_LIST</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;clr_flag&quot;</span><span class="p">,</span> <span class="s2">&quot;warmup_lr&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;clr_flag&quot;</span><span class="p">,</span> <span class="s2">&quot;reduce_lr&quot;</span><span class="p">]]</span>


<div class="viewcode-block" id="check_flag_conflicts"><a class="viewcode-back" href="../../candle/candle.html#candle.check_flag_conflicts">[docs]</a><span class="k">def</span> <span class="nf">check_flag_conflicts</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if parameters that must be exclusive are used in conjunction. The</span>
<span class="sd">    check is made against CONFLICT_LIST, a global list that describes parameter</span>
<span class="sd">    pairs that should be exclusive. Raises an exception if pairs of parameters</span>
<span class="sd">    in CONFLICT_LIST are specified simulataneously.</span>

<span class="sd">    :param Dict params: list to extract keywords from</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_set</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># check for conflicts</span>
    <span class="c1"># conflict_flag = False</span>
    <span class="c1"># loop over each set of mutually exclusive flags</span>
    <span class="c1"># if any set conflicts exit program</span>
    <span class="k">for</span> <span class="n">flag_list</span> <span class="ow">in</span> <span class="n">CONFLICT_LIST</span><span class="p">:</span>
        <span class="n">flag_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">flag_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">flag_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">flag_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;ERROR ! Conflict in flag specification. These flags should not be used together: &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">flag_list</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;... Exiting&quot;</span>
            <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">check_file_parameters_exists</span><span class="p">(</span>
    <span class="n">params_parser</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">,</span> <span class="n">params_benchmark</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">,</span> <span class="n">params_file</span><span class="p">:</span> <span class="n">ConfigDict</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Functionality to verify that the parameters defined in the configuration</span>
<span class="sd">    file are recognizable by the command line parser (i.e. no uknown keywords</span>
<span class="sd">    are used in the configuration file).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params_parser : python dictionary</span>
<span class="sd">        Includes parameters set via the command line.</span>
<span class="sd">    params_benchmark : python list</span>
<span class="sd">        Includes additional parameters defined in the benchmark.</span>
<span class="sd">    params_file : python dictionary</span>
<span class="sd">        Includes parameters read from the configuration file.</span>

<span class="sd">        Global:</span>
<span class="sd">        PARAMETERS_CANDLE : python list</span>
<span class="sd">            Includes all the core keywords that are specified in CANDLE.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get keywords from arguments coming via command line (and CANDLE supervisor)</span>
    <span class="n">args_dict</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">params_parser</span><span class="p">)</span>
    <span class="n">args_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">args_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># Get keywords from benchmark definition</span>
    <span class="n">bmk_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">params_benchmark</span><span class="p">:</span>
        <span class="n">bmk_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="n">bmk_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">bmk_keys</span><span class="p">)</span>
    <span class="c1"># Get core CANDLE keywords</span>
    <span class="n">candle_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">PARAMETERS_CANDLE</span><span class="p">)</span>
    <span class="c1"># Consolidate keywords from CANDLE core, command line, CANDLE supervisor and benchmark</span>
    <span class="n">candle_set</span> <span class="o">=</span> <span class="n">candle_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">args_set</span><span class="p">)</span>
    <span class="n">candle_set</span> <span class="o">=</span> <span class="n">candle_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">bmk_set</span><span class="p">)</span>
    <span class="c1"># Get keywords used in config_file</span>
    <span class="n">file_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">params_file</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># Compute keywords that come from the config_file that are not in the CANDLE specs</span>
    <span class="n">diff_set</span> <span class="o">=</span> <span class="n">file_set</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">candle_set</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;These keywords used in the configuration file are not defined in CANDLE: &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">diff_set</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>


<div class="viewcode-block" id="finalize_parameters"><a class="viewcode-back" href="../../candle/candle.html#candle.finalize_parameters">[docs]</a><span class="k">def</span> <span class="nf">finalize_parameters</span><span class="p">(</span><span class="n">bmk</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility to parse parameters in common as well as parameters particular</span>
<span class="sd">    to each benchmark.</span>

<span class="sd">    :param Benchmark bmk: Object that has benchmark filepaths and specifications</span>

<span class="sd">    :return: Dictionary with all the parameters necessary to run the benchmark.\</span>
<span class="sd">        Command line overwrites config file specifications</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parse common and benchmark parameters</span>
    <span class="n">bmk</span><span class="o">.</span><span class="n">parse_parameters</span><span class="p">()</span>

    <span class="c1"># print(&#39;Args:&#39;, args)</span>
    <span class="c1"># Get parameters from configuration file</span>
    <span class="c1"># Reads parameter subset, just checking if a config_file has been set</span>
    <span class="c1"># by comand line (the parse_known_args() function allows a partial</span>
    <span class="c1"># parsing)</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># Try to get the &#39;config_file&#39; option</span>
        <span class="n">conffile_txt</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">config_file</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># The &#39;config_file&#39; option was not set by command-line</span>
        <span class="n">conffile</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">conffile</span>  <span class="c1"># use default file</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># a &#39;config_file&#39; has been set --&gt; use this file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">conffile_txt</span><span class="p">):</span>
            <span class="n">conffile</span> <span class="o">=</span> <span class="n">conffile_txt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conffile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bmk</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">conffile_txt</span><span class="p">)</span>

    <span class="c1"># print(&quot;Configuration file: &quot;, conffile)</span>
    <span class="n">fileParameters</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">read_config_file</span><span class="p">(</span>
        <span class="n">conffile</span>
    <span class="p">)</span>  <span class="c1"># aux.config_file)#args.config_file)</span>
    <span class="c1"># Get command-line parameters</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c1"># print (&#39;Params:&#39;, fileParameters)</span>
    <span class="c1"># Check keywords from file against CANDLE common and module definitions</span>
    <span class="n">bmk_dict</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">additional_definitions</span>
    <span class="n">check_file_parameters_exists</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">bmk_dict</span><span class="p">,</span> <span class="n">fileParameters</span><span class="p">)</span>
    <span class="c1"># Consolidate parameter set. Command-line parameters overwrite file configuration</span>
    <span class="n">gParameters</span> <span class="o">=</span> <span class="n">args_overwrite_config</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fileParameters</span><span class="p">)</span>
    <span class="c1"># Check that required set of parameters has been defined</span>
    <span class="n">bmk</span><span class="o">.</span><span class="n">check_required_exists</span><span class="p">(</span><span class="n">gParameters</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Params:&quot;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">gParameters</span><span class="p">)</span>
    <span class="c1"># Check that no keywords conflict</span>
    <span class="n">check_flag_conflicts</span><span class="p">(</span><span class="n">gParameters</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gParameters</span></div>


<span class="k">def</span> <span class="nf">args_overwrite_config</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ConfigDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overwrite configuration parameters with parameters specified via</span>
<span class="sd">    command-line.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args : ArgumentParser object</span>
<span class="sd">        Parameters specified via command-line</span>
<span class="sd">    config : python dictionary</span>
<span class="sd">        Parameters read from configuration file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">config</span>

    <span class="n">args_dict</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># try casting here</span>
        <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;data_type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_DATATYPE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;f16&quot;</span><span class="p">,</span> <span class="s2">&quot;f32&quot;</span><span class="p">,</span> <span class="s2">&quot;f64&quot;</span><span class="p">]):</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_choice</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s2">&quot;output_dir&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory_from_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory_from_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s2">&quot;rng_seed&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;rng_seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_SEED</span>

    <span class="k">if</span> <span class="s2">&quot;timeout&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;timeout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TIMEOUT</span>

    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span> <span class="nf">get_choice</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maps name string to the right type of argument.&quot;&quot;&quot;</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># dtype</span>
    <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;f16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span>
    <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;f32&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;f64&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>

    <span class="n">mapped</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mapped</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No mapping found for &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">mapped</span>


<div class="viewcode-block" id="parse_from_dictlist"><a class="viewcode-back" href="../../candle/candle.html#candle.parse_from_dictlist">[docs]</a><span class="k">def</span> <span class="nf">parse_from_dictlist</span><span class="p">(</span><span class="n">dictlist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ParseDict</span><span class="p">],</span> <span class="n">parser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Functionality to parse options.</span>

<span class="sd">    :param List pardict: Specification of parameters</span>
<span class="sd">    :param ArgumentParser parser: Current parser</span>

<span class="sd">    :return: consolidated parameters</span>
<span class="sd">    :rtype: ArgumentParser</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dictlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># print(d[&#39;name&#39;], &#39;type is &#39;, d[&#39;type&#39;])</span>

        <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span>

        <span class="k">if</span> <span class="s2">&quot;help&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;abv&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;action&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>  <span class="c1"># Actions</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;list-of-lists&quot;</span>
            <span class="p">):</span>  <span class="c1"># Non standard. Specific functionallity has been added</span>
                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ListOfListsAction</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">dest</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">action</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">],</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">dest</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">action</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">],</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;store_true&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;store_false&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;The usage of store_true or store_false cannot be undone in the command line. Use type=str2bool instead.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">action</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">action</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Non actions</span>
            <span class="k">if</span> <span class="s2">&quot;nargs&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>  <span class="c1"># variable parameters</span>
                <span class="k">if</span> <span class="s2">&quot;choices&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>  <span class="c1"># choices with variable parameters</span>
                    <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                            <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="n">nargs</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nargs&quot;</span><span class="p">],</span>
                            <span class="n">choices</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">],</span>
                            <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                            <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                            <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="n">nargs</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nargs&quot;</span><span class="p">],</span>
                            <span class="n">choices</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">],</span>
                            <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                            <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Variable parameters (free, no limited choices)</span>
                    <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                            <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="n">nargs</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nargs&quot;</span><span class="p">],</span>
                            <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                            <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                            <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                            <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="n">nargs</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nargs&quot;</span><span class="p">],</span>
                            <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                            <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                            <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;choices&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>  <span class="c1"># Select from choice (fixed number of parameters)</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">choices</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">choices</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Non an action, one parameter, no choices</span>
                <span class="c1"># print(&#39;Adding &#39;, d[&#39;name&#39;], &#39; to parser&#39;)</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                        <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;abv&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                    <span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span></div>


<span class="k">def</span> <span class="nf">parse_common</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Functionality to parse options.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parser : ArgumentParser object</span>
<span class="sd">        Current parser</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">registered_conf</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parse_from_dictlist</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 | https://www.anl.gov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>