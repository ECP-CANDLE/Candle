

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>default_utils &mdash; CANDLE  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="CANDLE  documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> CANDLE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">What is CANDLE?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">CANDLE Library API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CANDLE</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>default_utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for default_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">configparser</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ConfigParser</span> <span class="k">as</span> <span class="nn">configparser</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;common&#39;</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lib_path</span><span class="p">)</span>

<span class="n">work_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">file_utils</span> <span class="k">import</span> <span class="n">get_file</span>

<span class="c1"># Seed for random generation -- default value</span>
<span class="n">DEFAULT_SEED</span> <span class="o">=</span> <span class="mi">7102</span>
<span class="n">DEFAULT_TIMEOUT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># no timeout</span>
<span class="n">DEFAULT_DATATYPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>


<span class="c1">#### IO UTILS</span>

<div class="viewcode-block" id="fetch_file"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.fetch_file">[docs]</a><span class="k">def</span> <span class="nf">fetch_file</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">untar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">md5_hash</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">link</span><span class="p">,</span> <span class="n">untar</span><span class="o">=</span><span class="n">untar</span><span class="p">,</span> <span class="n">md5_hash</span><span class="o">=</span><span class="n">md5_hash</span><span class="p">,</span> <span class="n">cache_subdir</span><span class="o">=</span><span class="n">subdir</span><span class="p">)</span></div>

<div class="viewcode-block" id="verify_path"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.verify_path">[docs]</a><span class="k">def</span> <span class="nf">verify_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">folder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_up_logger"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.set_up_logger">[docs]</a><span class="k">def</span> <span class="nf">set_up_logger</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
    <span class="n">verify_path</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(process)d</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">sh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span></div>


<span class="c1">#### REFORMATING UTILS</span>


<div class="viewcode-block" id="eval_string_as_list"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.eval_string_as_list">[docs]</a><span class="k">def</span> <span class="nf">eval_string_as_list</span><span class="p">(</span><span class="n">str_read</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a string and convert it into a list of lists.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        str_read : string</span>
<span class="sd">            string read (from configuration file or command line, for example)</span>
<span class="sd">        separator : character</span>
<span class="sd">            character that specifies the separation between the lists</span>
<span class="sd">        dtype : data type</span>
<span class="sd">            data type to decode the elements of the list</span>
<span class="sd">            </span>
<span class="sd">        Return</span>
<span class="sd">        ----------</span>
<span class="sd">        decoded_list : list extracted from string and with elements of the</span>
<span class="sd">            specified type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Figure out desired type</span>
    <span class="n">ldtype</span> <span class="o">=</span> <span class="n">dtype</span>
    <span class="k">if</span> <span class="n">ldtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ldtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>

    <span class="c1"># Split list</span>
    <span class="n">decoded_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_list</span> <span class="o">=</span> <span class="n">str_read</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>

    <span class="c1"># Convert to desired type</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">out_list</span><span class="p">:</span>
        <span class="n">decoded_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ldtype</span><span class="p">(</span> <span class="n">el</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">decoded_list</span></div>



<div class="viewcode-block" id="eval_string_as_list_of_lists"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.eval_string_as_list_of_lists">[docs]</a><span class="k">def</span> <span class="nf">eval_string_as_list_of_lists</span><span class="p">(</span><span class="n">str_read</span><span class="p">,</span> <span class="n">separator_out</span><span class="p">,</span> <span class="n">separator_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a string and convert it into a list of lists.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        str_read : string</span>
<span class="sd">            string read (from configuration file or command line, for example)</span>
<span class="sd">        separator_out : character</span>
<span class="sd">            character that specifies the separation between the outer level lists</span>
<span class="sd">        separator_in : character</span>
<span class="sd">            character that specifies the separation between the inner level lists</span>
<span class="sd">        dtype : data type</span>
<span class="sd">            data type to decode the elements of the lists</span>
<span class="sd">            </span>
<span class="sd">        Return</span>
<span class="sd">        ----------</span>
<span class="sd">        decoded_list : list of lists extracted from string and with elements</span>
<span class="sd">            of the specified type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Figure out desired type</span>
    <span class="n">ldtype</span> <span class="o">=</span> <span class="n">dtype</span>
    <span class="k">if</span> <span class="n">ldtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ldtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>

    <span class="c1"># Split outer list</span>
    <span class="n">decoded_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_list</span> <span class="o">=</span> <span class="n">str_read</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator_out</span><span class="p">)</span>
    <span class="c1"># Split each internal list</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">out_list</span><span class="p">:</span>
        <span class="n">in_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator_in</span><span class="p">)</span>
        <span class="c1"># Convert to desired type</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
            <span class="n">in_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ldtype</span><span class="p">(</span> <span class="n">el</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">decoded_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">in_list</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">decoded_list</span></div>


<div class="viewcode-block" id="str2bool"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.str2bool">[docs]</a><span class="k">def</span> <span class="nf">str2bool</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is taken from:</span>
<span class="sd">        https://stackoverflow.com/questions/15008758/parsing-boolean-values-with-argparse</span>
<span class="sd">        Because type=bool is not interpreted as a bool and action=&#39;store_true&#39; cannot be</span>
<span class="sd">        undone.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentTypeError</span><span class="p">(</span><span class="s1">&#39;Boolean value expected.&#39;</span><span class="p">)</span></div>

<span class="c1">#### CLASS DEFINITIONS</span>

<div class="viewcode-block" id="ArgumentStruct"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.ArgumentStruct">[docs]</a><span class="k">class</span> <span class="nc">ArgumentStruct</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Structure to keep all the parameters from a </span>
<span class="sd">       dictionary (corresponding to problem parameters) </span>
<span class="sd">       under a unified object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">entries</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span></div>



<div class="viewcode-block" id="ListOfListsAction"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.ListOfListsAction">[docs]</a><span class="k">class</span> <span class="nc">ListOfListsAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_strings</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This action allows to construct a parser from a string</span>
<span class="sd">           to a list of lists.</span>
<span class="sd">           If no type is specified, an integer is assumed by default</span>
<span class="sd">           as the type for the elements of the list of lists.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ListOfListsAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">option_strings</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
    


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This parses a string and maps into a list of lists.</span>
<span class="sd">           It assumes that the separator between lists is a colon &#39;:&#39;</span>
<span class="sd">           and the separator inside the list is a comma &#39;,&#39;.</span>
<span class="sd">           The values of the list are casted to the type specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">decoded_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">removed1</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">removed2</span> <span class="o">=</span> <span class="n">removed1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">out_list</span> <span class="o">=</span> <span class="n">removed2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">out_list</span><span class="p">:</span>
            <span class="n">in_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">elem</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                <span class="n">in_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span> <span class="n">el</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">decoded_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">in_list</span> <span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">decoded_list</span><span class="p">)</span></div>

<span class="c1">#### INITIALIZATION UTILS</span>


<div class="viewcode-block" id="set_seed"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.set_seed">[docs]</a><span class="k">def</span> <span class="nf">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONHASHSEED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span></div>


<div class="viewcode-block" id="initialize_parameters"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.initialize_parameters">[docs]</a><span class="k">def</span> <span class="nf">initialize_parameters</span><span class="p">(</span><span class="n">bmk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse parameters in common and particular to each benchmark.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bmk : benchmark object</span>
<span class="sd">            Object that has benchmark filepaths and especifications</span>
<span class="sd">            </span>
<span class="sd">        Return</span>
<span class="sd">        ----------</span>
<span class="sd">        gParameters : dictionary with all the parameters necessary to run the benchmark.</span>
<span class="sd">            Command line overwrites config file especifications</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parse common parameters</span>
    <span class="n">bmk</span><span class="o">.</span><span class="n">parse_from_common</span><span class="p">()</span>
    <span class="c1"># Parse parameters that are applicable just to benchmark</span>
    <span class="n">bmk</span><span class="o">.</span><span class="n">parse_from_benchmark</span><span class="p">()</span>

    <span class="c1">#print(&#39;Args:&#39;, args)</span>
    <span class="c1"># Get parameters from configuration file</span>
    <span class="c1"># Reads parameter subset, just checking if a config_file has been set</span>
    <span class="c1"># by comand line (the parse_known_args() function allows a partial</span>
    <span class="c1"># parsing)</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
    <span class="k">try</span> <span class="p">:</span> <span class="c1"># Try to get the &#39;config_file&#39; option</span>
        <span class="n">conffile_txt</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">config_file</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># The &#39;config_file&#39; option was not set by command-line</span>
        <span class="n">conffile</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">conffile</span> <span class="c1"># use default file</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># a &#39;config_file&#39; has been set --&gt; use this file</span>
        <span class="n">conffile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bmk</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">conffile_txt</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configuration file: &quot;</span><span class="p">,</span> <span class="n">conffile</span><span class="p">)</span>
    <span class="n">fileParameters</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">read_config_file</span><span class="p">(</span><span class="n">conffile</span><span class="p">)</span><span class="c1">#aux.config_file)#args.config_file)</span>
    <span class="c1"># Get command-line parameters</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">bmk</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c1">#print (&#39;Params:&#39;, fileParameters)</span>
    <span class="c1"># Consolidate parameter set. Command-line parameters overwrite file configuration</span>
    <span class="n">gParameters</span> <span class="o">=</span> <span class="n">args_overwrite_config</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fileParameters</span><span class="p">)</span>
    <span class="c1"># Check that required set of parameters has been defined</span>
    <span class="n">bmk</span><span class="o">.</span><span class="n">check_required_exists</span><span class="p">(</span><span class="n">gParameters</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Params:&#39;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">gParameters</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gParameters</span></div>


<div class="viewcode-block" id="get_default_neon_parser"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.get_default_neon_parser">[docs]</a><span class="k">def</span> <span class="nf">get_default_neon_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse command-line arguments that are default in neon parser (and are common to all frameworks). </span>
<span class="sd">        Ignore if not present.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parser : python argparse</span>
<span class="sd">            parser for neon default command-line options</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Logging Level</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">str2bool</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;increase output verbosity&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="s2">&quot;--log&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;logfile&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;log file&quot;</span><span class="p">)</span>
                        
    <span class="c1"># Logging utilities</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--save_path&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;file path to save model snapshots&quot;</span><span class="p">)</span>

    <span class="c1"># General behavior</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--model_file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;weight_path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;specify trained model Pickle file&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;--data_type&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;datatype&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f16&#39;</span><span class="p">,</span> <span class="s1">&#39;f32&#39;</span><span class="p">,</span> <span class="s1">&#39;f64&#39;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;default floating point&quot;</span><span class="p">)</span>

    <span class="c1"># Model definition</span>
    <span class="c1"># Model Architecture</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--dense&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of units in fully connected layers in an integer array&quot;</span><span class="p">)</span>

    <span class="c1"># Data preprocessing</span>
    <span class="c1">#parser.add_argument(&quot;--shuffle&quot;, type=str2bool,</span>
    <span class="c1">#                    default=True,</span>
    <span class="c1">#                    help=&quot;randomly shuffle data set (produces different training and testing partitions each run depending on the seed)&quot;)</span>

    <span class="c1"># Training configuration</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="s2">&quot;--rng_seed&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;rng_seed&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;random number generator seed&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;--epochs&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of training epochs&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-z&quot;</span><span class="p">,</span> <span class="s2">&quot;--batch_size&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;batch size&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="get_common_parser"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.get_common_parser">[docs]</a><span class="k">def</span> <span class="nf">get_common_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse command-line arguments. Ignore if not present.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parser : python argparse</span>
<span class="sd">            parser for command-line options</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Configuration file</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--config_file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;config_file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;specify model configuration file&quot;</span><span class="p">)</span>
    
    <span class="c1"># General behavior</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--train_bool&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;train_bool&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">str2bool</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;train model&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--eval_bool&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;eval_bool&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">str2bool</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;evaluate model (use it for inference)&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--timeout&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;seconds allowed to train model (default: no timeout)&quot;</span><span class="p">)</span>


    <span class="c1"># Logging utilities</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--home_dir&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;home_dir&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set home directory&quot;</span><span class="p">)</span>
                        
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--train_data&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;training data filename&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--test_data&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;testing data filename&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--output_dir&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;output_dir&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;output directory&quot;</span><span class="p">)</span>
                        
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--data_url&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;data_url&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set data source url&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--experiment_id&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;EXP000&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set the experiment unique identifier&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--run_id&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;RUN000&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set the run unique identifier&quot;</span><span class="p">)</span>
    


    <span class="c1"># Model definition</span>
    <span class="c1"># Model Architecture</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--conv&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;integer array describing convolution layers: conv1_filters, conv1_filter_len, conv1_stride, conv2_filters, conv2_filter_len, conv2_stride ...&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--locally_connected&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">str2bool</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use locally connected layers instead of convolution layers&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="s2">&quot;--activation&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;keras activation function to use in inner layers: relu, tanh, sigmoid...&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--out_activation&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;keras activation function to use in out layer: softmax, linear, ...&quot;</span><span class="p">)</span>
                        
                        
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--lstm_size&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;integer array describing size of LSTM internal state per layer&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--recurrent_dropout&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ratio of recurrent dropout&quot;</span><span class="p">)</span>
                        
                        
    <span class="c1"># Processing between layers</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--drop&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ratio of dropout used in fully connected layers&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--pool&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;pooling layer length&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--batch_normalization&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">str2bool</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use batch normalization&quot;</span><span class="p">)</span>
                        
    <span class="c1"># Model Evaluation</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--loss&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;keras loss function to use: mse, ...&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--optimizer&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;keras optimizer to use: sgd, rmsprop, ...&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--metrics&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;metrics to evaluate performance: accuracy, ...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Data preprocessing</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--scaling&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;minabs&#39;</span><span class="p">,</span> <span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;type of feature scaling; &#39;minabs&#39;: to [-1,1]; &#39;minmax&#39;: to [0,1], &#39;std&#39;: standard unit normalization; &#39;none&#39;: no normalization&quot;</span><span class="p">)</span>
                        
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--shuffle&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">str2bool</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;randomly shuffle data set (produces different training and testing partitions each run depending on the seed)&quot;</span><span class="p">)</span>

    <span class="c1"># Feature selection</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--feature_subsample&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of features to randomly sample from each category (cellline expression, drug descriptors, etc), 0 means using all features&quot;</span><span class="p">)</span>

    <span class="c1"># Training configuration</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--learning_rate&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;overrides the learning rate for training&quot;</span><span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--initialization&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;glorot_uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;lecun_uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;he_normal&#39;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;type of weight initialization; &#39;constant&#39;: to 0; &#39;uniform&#39;: to [-0.05,0.05], &#39;normal&#39;: mean 0, stddev 0.05; &#39;glorot_uniform&#39;: [-lim,lim] with lim = sqrt(6/(fan_in+fan_out)); &#39;lecun_uniform&#39; : [-lim,lim] with lim = sqrt(3/fan_in); &#39;he_normal&#39; : mean 0, stddev sqrt(2/fan_in)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--val_split&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;fraction of data to use in validation&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--train_steps&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;overrides the number of training batches per epoch if set to nonzero&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--val_steps&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;overrides the number of validation batches per epoch if set to nonzero&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--test_steps&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;overrides the number of test batches per epoch if set to nonzero&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--train_samples&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;overrides the number of training samples if set to nonzero&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--val_samples&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;overrides the number of validation samples if set to nonzero&quot;</span><span class="p">)</span>
    
    
    <span class="c1"># Backend configuration</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--gpus&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set IDs of GPUs to use&quot;</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">parser</span></div>



<div class="viewcode-block" id="args_overwrite_config"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.args_overwrite_config">[docs]</a><span class="k">def</span> <span class="nf">args_overwrite_config</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Overwrite configuration parameters with </span>
<span class="sd">        parameters specified via command-line.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : python argparse</span>
<span class="sd">            parameters specified via command-line</span>
<span class="sd">        config : python dictionary</span>
<span class="sd">            parameters read from configuration file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">params</span> <span class="o">=</span> <span class="n">config</span>
    
    <span class="n">args_dict</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    
    
    <span class="k">if</span> <span class="s1">&#39;datatype&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;datatype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_DATATYPE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;datatype&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;f16&#39;</span><span class="p">,</span> <span class="s1">&#39;f32&#39;</span><span class="p">,</span> <span class="s1">&#39;f64&#39;</span><span class="p">]):</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;datatype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_choice</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;datatype&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;output_dir&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory_from_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory_from_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;rng_seed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rng_seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_SEED</span>

    <span class="k">if</span> <span class="s1">&#39;timeout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TIMEOUT</span>


    <span class="k">return</span> <span class="n">params</span></div>



<div class="viewcode-block" id="get_choice"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.get_choice">[docs]</a><span class="k">def</span> <span class="nf">get_choice</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Maps name string to the right type of argument</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># dtype</span>
    <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;f16&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span>
    <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;f32&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;f64&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
    
    <span class="n">mapped</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mapped</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No mapping found for &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">mapped</span></div>


<div class="viewcode-block" id="directory_from_parameters"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.directory_from_parameters">[docs]</a><span class="k">def</span> <span class="nf">directory_from_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">commonroot</span><span class="o">=</span><span class="s1">&#39;Output&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct output directory path with unique IDs from parameters&quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">commonroot</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;./&#39;</span><span class="p">]):</span> <span class="c1"># Same directory --&gt; convert to absolute path</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># Create path specified</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">commonroot</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;experiment_id&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

        <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;run_id&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">outdir</span></div>



<div class="viewcode-block" id="Benchmark"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.Benchmark">[docs]</a><span class="k">class</span> <span class="nc">Benchmark</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">defmodel</span><span class="p">,</span> <span class="n">framework</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize benchmark object. Object to group common and </span>
<span class="sd">        specific (to benchmark) configuration options.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            filepath : ./</span>
<span class="sd">                os.path.dirname where the benchmark is located. Necessary to locate utils and</span>
<span class="sd">                establish input/ouput paths</span>
<span class="sd">            defmodel : &#39;p*b*_default_model.txt&#39;</span>
<span class="sd">                string corresponding to the default model of the benchmark</span>
<span class="sd">            framework : &#39;keras&#39;, &#39;neon&#39;, &#39;mxnet&#39;, &#39;pytorch&#39;</span>
<span class="sd">                framework used to run the benchmark</span>
<span class="sd">            prog : &#39;p*b*_baseline_*&#39;</span>
<span class="sd">                string for program name (usually associated to benchmark and framework)</span>
<span class="sd">            desc : &#39; &#39;</span>
<span class="sd">                string describing benchmark (usually a description of the neural network model built)</span>
<span class="sd">            parser : argparser (default None)</span>
<span class="sd">                if &#39;neon&#39; framework a NeonArgparser is passed. Otherwise an argparser is constructed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="n">prog</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">conflict_handler</span><span class="o">=</span><span class="s1">&#39;resolve&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_model</span> <span class="o">=</span> <span class="n">defmodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">framework</span> <span class="o">=</span> <span class="n">framework</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_definitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_locals</span><span class="p">()</span>
        


<div class="viewcode-block" id="Benchmark.parse_from_common"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.Benchmark.parse_from_common">[docs]</a>    <span class="k">def</span> <span class="nf">parse_from_common</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Functionality to parse options common</span>
<span class="sd">           for all benchmarks.</span>
<span class="sd">           This functionality is based on methods &#39;get_default_neon_parser&#39; and</span>
<span class="sd">           &#39;get_common_parser&#39; which are defined previously(above). If the order changes</span>
<span class="sd">           or they are moved, the calling has to be updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        
        <span class="c1"># Parse has been split between arguments that are common with the default neon parser</span>
        <span class="c1"># and all the other options</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">framework</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;neon&#39;</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">get_default_neon_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">get_common_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>

        <span class="c1"># Set default configuration file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conffile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_model</span><span class="p">)</span></div>


<div class="viewcode-block" id="Benchmark.parse_from_benchmark"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.Benchmark.parse_from_benchmark">[docs]</a>    <span class="k">def</span> <span class="nf">parse_from_benchmark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Functionality to parse options specific</span>
<span class="sd">           specific for each benchmark.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_definitions</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s1">&#39;default&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span>
            <span class="k">if</span> <span class="s1">&#39;help&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="c1"># Actions</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;list-of-lists&#39;</span><span class="p">:</span> <span class="c1"># Non standard. Specific functionallity has been added</span>
                    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ListOfListsAction</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">dest</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;store_true&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;store_false&#39;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="s1">&#39;The usage of store_true or store_false cannot be undone in the command line. Use type=str2bool instead.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">action</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Non actions</span>
                <span class="k">if</span> <span class="s1">&#39;nargs&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="c1"># variable parameters</span>
                    <span class="k">if</span> <span class="s1">&#39;choices&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="c1"># choices with variable parameters</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">nargs</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nargs&#39;</span><span class="p">],</span> <span class="n">choices</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;choices&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># Variable parameters (free, no limited choices)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">nargs</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;nargs&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="s1">&#39;choices&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="c1"># Select from choice (fixed number of parameters)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">choices</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;choices&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># Non an action, one parameter, no choices</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">])</span></div>
                


<div class="viewcode-block" id="Benchmark.format_benchmark_config_arguments"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.Benchmark.format_benchmark_config_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">format_benchmark_config_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictfileparam</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Functionality to format the particular parameters of</span>
<span class="sd">           the benchmark.</span>
<span class="sd">           </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            dictfileparam : python dictionary</span>
<span class="sd">                parameters read from configuration file</span>
<span class="sd">            args : python dictionary</span>
<span class="sd">                parameters read from command-line</span>
<span class="sd">                Most of the time command-line overwrites configuration file</span>
<span class="sd">                except when the command-line is using default values and</span>
<span class="sd">                config file defines those values</span>
<span class="sd">           </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">configOut</span> <span class="o">=</span> <span class="n">dictfileparam</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_definitions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">configOut</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>
                
                <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]):</span>
                        <span class="n">str_read</span> <span class="o">=</span> <span class="n">dictfileparam</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
                        <span class="n">configOut</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">eval_string_as_list_of_lists</span><span class="p">(</span><span class="n">str_read</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">:</span>
                    <span class="c1"># default value on benchmark definition cannot overwrite config file</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">configOut</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]],</span> <span class="n">help</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">configOut</span></div>



<div class="viewcode-block" id="Benchmark.read_config_file"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.Benchmark.read_config_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Functionality to read the configue file</span>
<span class="sd">           specific for each benchmark.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span><span class="o">=</span><span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">section</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        <span class="n">fileParams</span><span class="o">=</span><span class="p">{}</span>
        
        <span class="c1"># parse specified arguments (minimal validation: if arguments</span>
        <span class="c1"># are written several times in the file, just the first time</span>
        <span class="c1"># will be used)</span>
        <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fileParams</span><span class="p">:</span>
                    <span class="n">fileParams</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    
        <span class="n">fileParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_benchmark_config_arguments</span><span class="p">(</span><span class="n">fileParams</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">fileParams</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">fileParams</span></div>



<div class="viewcode-block" id="Benchmark.set_locals"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.Benchmark.set_locals">[docs]</a>    <span class="k">def</span> <span class="nf">set_locals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Functionality to set variables specific for the benchmark</span>
<span class="sd">        - required: set of required parameters for the benchmark.</span>
<span class="sd">        - additional_definitions: list of dictionaries describing the additional parameters for the</span>
<span class="sd">        benchmark.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">pass</span></div>


        
<div class="viewcode-block" id="Benchmark.check_required_exists"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.Benchmark.check_required_exists">[docs]</a>    <span class="k">def</span> <span class="nf">check_required_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gparam</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Functionality to verify that the required </span>
<span class="sd">           model parameters have been specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">key_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">gparam</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">intersect_set</span> <span class="o">=</span> <span class="n">key_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">)</span>
        <span class="n">diff_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">intersect_set</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR ! Required parameters are not specified. &#39;</span> \
            <span class="s1">&#39;These required parameters have not been initialized: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">diff_set</span><span class="p">))</span> <span class="o">+</span> \
            <span class="s1">&#39;... Exiting&#39;</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="keras_default_config"><a class="viewcode-back" href="../candle_lib/default_utils.html#default_utils.keras_default_config">[docs]</a><span class="k">def</span> <span class="nf">keras_default_config</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Defines parameters that intervine in different functions using the keras defaults.</span>
<span class="sd">        This helps to keep consistency in parameters between frameworks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">kerasDefaults</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># Optimizers</span>
    <span class="c1">#kerasDefaults[&#39;clipnorm&#39;]=?            # Maximum norm to clip all parameter gradients</span>
    <span class="c1">#kerasDefaults[&#39;clipvalue&#39;]=?          # Maximum (minimum=-max) value to clip all parameter gradients</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;decay_lr&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>            <span class="c1"># Learning rate decay over each update</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">1e-8</span>           <span class="c1"># Factor to avoid divide by zero (fuzz factor)</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.9</span>                <span class="c1"># Decay parameter in some optmizer updates (rmsprop, adadelta)</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;momentum_sgd&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>        <span class="c1"># Momentum for parameter update in sgd optimizer</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;nesterov_sgd&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>     <span class="c1"># Whether to apply Nesterov momentum in sgd optimizer</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;beta_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.9</span>             <span class="c1"># Parameter in some optmizer updates (adam, adamax, nadam)</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;beta_2&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.999</span>           <span class="c1"># Parameter in some optmizer updates (adam, adamax, nadam)</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;decay_schedule_lr&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.004</span><span class="c1"># Parameter for nadam optmizer</span>

    <span class="c1"># Initializers</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;minval_uniform&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mf">0.05</span>   <span class="c1">#  Lower bound of the range of random values to generate</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;maxval_uniform&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.05</span>    <span class="c1">#  Upper bound of the range of random values to generate</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;mean_normal&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>         <span class="c1">#  Mean of the random values to generate</span>
    <span class="n">kerasDefaults</span><span class="p">[</span><span class="s1">&#39;stddev_normal&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.05</span>     <span class="c1">#  Standard deviation of the random values to generate</span>


    <span class="k">return</span> <span class="n">kerasDefaults</span></div>

</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, ANL.gov.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>